/-
Copyright (c) 2026 D. and Wise Wolf. All rights reserved.
Released under MIT license as described in the file LICENSE.
Authors: D. and Wise Wolf.
-/

import Mathlib

namespace DkMath

/-
  Silver Ratio Unit formalization (core lemmas)

  Notation policy:
    σ     := 1 + √2
    uAg   := σ / 2
    ΔAg   := uAg^2 - uAg = 1/4
    e     := Real.exp 1
-/

namespace SilverRatioUnit

open Real

noncomputable section

/-- √2 as a real number -/
def sqrt2 : ℝ := Real.sqrt 2

/-- silver ratio: σ := 1 + √2 -/
def sigma : ℝ := 1 + sqrt2

/-- silver ratio unit: uAg := σ / 2 = (1 + √2)/2 -/
def uAg : ℝ := sigma / 2

/-- ΔAg := uAg^2 - uAg (the constant "gap" in the uAg-world) -/
def deltaAg : ℝ := uAg^2 - uAg

/-- Key lemma: sqrt2 ^ 2 = 2 (robust) -/
@[simp] lemma sqrt2_sq : sqrt2 ^ 2 = (2 : ℝ) := by
  unfold sqrt2
  simp [pow_two, Real.mul_self_sqrt]

/-- sqrt2 > 0 -/
lemma sqrt2_pos : 0 < sqrt2 := by
  unfold sqrt2
  exact Real.sqrt_pos.mpr (by norm_num : (0 : ℝ) < 2)

/-- sqrt2 ≠ 0 -/
lemma sqrt2_ne_zero : sqrt2 ≠ 0 := ne_of_gt sqrt2_pos

/-- sqrt2 is irrational -/
lemma sqrt2_irrational : Irrational sqrt2 := by
  unfold sqrt2
  exact irrational_sqrt_two

@[simp] lemma uAg_eq : uAg = (1 + sqrt2) / 2 := by
  simp [uAg, sigma, div_eq_mul_inv]

/--
Main closure law for the silver ratio unit:
uAg^2 = uAg + 1/4.
-/
theorem uAg_sq_eq : uAg^2 = uAg + (1/4 : ℝ) := by
  have h : sqrt2 ^ 2 = (2 : ℝ) := sqrt2_sq
  simp [uAg_eq, pow_two]
  field_simp [pow_two]
  -- goal is purely algebraic now
  -- Use h to replace sqrt2^2
  -- (ring handles the rest)
  calc
    (1 + sqrt2) ^ 2 * 4
        = (1 + 2 * sqrt2 + sqrt2 ^ 2) * 4 := by ring
    _   = (1 + 2 * sqrt2 + 2) * 4 := by simp [h]
    _   = 2 * ((1 + sqrt2) * 4 + 2) := by ring

/-- The gap is constant: ΔAg = 1/4. -/
theorem deltaAg_eq : deltaAg = (1/4 : ℝ) := by
  -- ΔAg := uAg^2 - uAg
  -- use uAg_sq_eq
  rw [deltaAg, uAg_sq_eq]
  ring

/-- e/4 = e * ΔAg, where e := exp 1. -/
theorem e_div_four_eq_e_mul_delta :
    (Real.exp 1) / 4 = (Real.exp 1) * deltaAg := by
  -- ΔAg = 1/4 を代入するだけ
  simp only [div_eq_mul_inv, mul_comm, deltaAg_eq, one_mul]

/-- Observed coefficient: α := 4/e. -/
def alpha : ℝ := 4 / (Real.exp 1)

/-- α⁻¹ = e * ΔAg (so α⁻¹ = e/4). -/
theorem inv_alpha_eq_e_mul_delta :
    (alpha)⁻¹ = (Real.exp 1) * deltaAg := by
  -- alpha⁻¹ = (4 / e)⁻¹ = e / 4, then use the previous theorem.
  -- In a field, `(a / b)⁻¹ = b / a` holds by simp.
  have : (alpha)⁻¹ = (Real.exp 1) / 4 := by
    -- `(4 / e)⁻¹ = e / 4`
    simp [alpha]
  -- now replace (exp 1)/4 with exp 1 * ΔAg
  simpa [this] using (e_div_four_eq_e_mul_delta)

end -- noncomputable section
end SilverRatioUnit
end DkMath
