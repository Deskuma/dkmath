# 単位増分と非閉路性の形式化 設計図（Lean プロジェクト用）

## 目的

本ドキュメントは、「単位（+1）が残る構造は非自明な閉路を持たない」という主張を、Lean/mathlib 上で**形式化・証明可能な形**に落とすための設計図である。

直観的には次を示す：

- 反復（周回）で状態が「閉じる（元に戻る）」ためには、単位増分が 0 である必要がある。
- 単位増分が 1（あるいは u≠0）である世界では、反復のたびに不変量が単調増加し、非自明な閉路は存在しない。

本主張は e や π など具体定数には依存せず、**反復・不変量・単位増分**の抽象的構造として確立する。

---

## 用語・概念（最小セット）

### 状態（State）

反復される対象。最初は最小構成として自然数成分を持つ構造体で十分。

### 遷移（step / transition）

状態を 1 回更新する写像 `T : State → State`。

### 反復（iterate）

`T` を k 回適用した写像 `T^[k]`。

### 閉路（cycle / closed）

`T^[k] s = s` を満たす k>0 が存在すること。

### 不変量（invariant / potential）

状態から自然数（あるいは線形順序）への写像 `I : State → α`。

### 単位増分（unit increment）

`I (T s) = I s + u`（u>0）型の増分則。これが閉路を禁止する本質。

---

## 主定理（仕様）

### 定理 A（最小版：+1 増分）

**仮定**

- `T : State → State`
- `I : State → ℕ`
- `∀ s, I (T s) = I s + 1`

**結論**

- `T^[k] s = s → k = 0`
- 特に `k>0` の閉路は存在しない。

直観：`I (T^[k] s) = I s + k` なので、等式 `I s + k = I s` が必要となり `k=0`。

### 定理 B（一般版：u 増分）

**仮定**

- `I : State → ℕ`
- `∀ s, I (T s) = I s + u`（u は固定）

**結論**

- `T^[k] s = s → k*u = 0`
- `u>0` なら `k=0`。

※将来拡張として `α` を `OrderedCancelAddCommMonoid` 等に一般化可能。

---

## 実装計画（Lean ファイル構成案）

### 1) コア補題層（抽象）

**ファイル案**：`DkMath/UnitCycle/Core.lean`

内容：

- `iterate` を `Nat.iterate` で使用
- `I_T`（増分則）の仮定から `I_iterate`（反復後の増分）を帰納法で証明
- 閉路否定定理 `no_nontrivial_cycle` を証明

### 2) 具体インスタンス層（最小の State）

**ファイル案**：`DkMath/UnitCycle/Examples.lean`

内容：

- `structure State` を最小に定義（例：`val : ℕ`）
- `T s := ⟨s.val + 1⟩` の例
- `I s := s.val`
- コア定理を適用して閉路不可能を確認

### 3) 宇宙式接続層（将来）

**ファイル案**：`DkMath/UnitCycle/CosmicBridge.lean`

内容：

- 宇宙式 `N+1=(P+1)^2` を State の別成分として持たせる
- `T` を「周回」操作として具体化（相対多角数・円環数の遷移定義に合わせる）
- `I` を「ギャップ」または「単位残差」量として設計
- `I (T s) = I s + u` を導く

---

## 証明スケッチ（Lean 的な骨組み）

### 補題 1：反復による増分

目標：

- `I (Nat.iterate T k s) = I s + k`（+1 増分の場合）

方法：

- `k` による帰納法
- `Nat.iterate_succ` を使って
  - `iterate (k+1) T s = iterate k T (T s)`
- `simp` と `Nat.add_assoc` で整形

### 補題 2：閉路なら k=0

目標：

- `Nat.iterate T k s = s → k = 0`

方法：

- 等式に `congrArg I` を適用
- 補題1で左辺を `I s + k` に変換
- `Nat.add_left_cancel` 等で `k=0`

---

## 仕様の意義（数学的メッセージ）

- 「閉じる（円環構造）」は、反復で差分が消えることを要請する。
- 「単位が残る（+1 が必要）」構造は、反復のたびに単調増加するポテンシャルを持つ。
- したがって、単位が残る世界は**非閉路**であり、閉路化するには単位を 0 に潰す必要がある。

---

## テスト・検証方針

- `Examples.lean` で最小例が `lake build` で通ることを確認
- その後、宇宙式ブリッジ層で具体遷移（相対多角数の周回）に適用
- 遷移設計が変わっても、`I_T`（増分則）さえ示せればコア定理は再利用できる

---

## 次の TODO

1. `Core.lean` の抽象定理をまず完成（最短でビルドOK✅）
2. `u` 版（定理B）へ一般化（`u>0` で閉路なし）
3. 相対多角数の「周回」写像 `T_polygon` を定義
4. `I` を「ギャップ残差」「未充填単位」などで定義し、`I_T` を導出
5. 宇宙式 `N+1=(P+1)^2` の +1 が閉路阻害の具体例になることをブリッジ層で明示

---

## 補足：設計上の注意

- `I` は必ず「反復で増える」量を選ぶ。
- 閉路否定は `I` の単調増加性（あるいは加法増分則）で一撃。
- `Nat` で始めると簡単だが、将来 `OrderedCancelAddCommMonoid` へ一般化可能。

---

（この設計図は、Lean 形式化の入口であり、以後の相対多角数・円環数・宇宙式接続の基礎部品として再利用される。）
