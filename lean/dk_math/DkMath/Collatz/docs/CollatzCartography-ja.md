# Collatz Cartography（コラッツ地図学）  

— 相対多角数（花弁）視点による「区間保存」と「特異筋」の観測 —

> この文書は、コラッツ予想を **等比区間 \(2^k\)** の自己相似（花弁）として捉え、  
> **差分が生まれる場所＝特異筋** を可視化し、  
> “跳ね上がり” と “収束確定っぽさ” を分ける **境界条件（不等式候補）** を数値観測で抽出するための設計資料である。

---

## 0. 目的（このプロジェクトは何を狙うか）

本プロジェクトの狙いは、コラッツ予想を「証明する／しない」という大看板の前に、まず次を確定することにある：

1. **花弁（ブロック）内での保存則**  
   オフセット \(+2^k m\) による “同型” がどこまで続くか。

2. **差分が生まれる場所の同定**  
   差分が出るのはどこか？  
   それは \(v_2(3n+1)\) が大きい箇所（特異筋）に集中するか？

3. **跳ね上がり条件の観測**  
   途中経過の “山” を統計化し、  
   悪いケース（Bad）を区間内で濃淡として捉える。

---

## 1. 世界観（花弁モデル）

自然数世界を等比区間 \(2^k\) で分割し、各区間を「花弁」と見なす：

- ブロックサイズ \(B := 2^k\)
- 花弁（ブロック）\([0,B),[B,2B),\dots\)

同じ花弁構造がスケールを変えて繰り返されるという立場に立つと、

- “同じ花弁内” は過去の結果を保持しやすい（保存則）
- ずれ（オフセット）は主に **境界・特異点** で顕在化する

という仮説が自然に出る。

---

## 2. 加速コラッツ（観測系の定義）

奇数 \(n\) 上で、加速コラッツ写像を

\[
T(n) := \frac{3n+1}{2^{v_2(3n+1)}} \quad (\text{結果は常に奇数})
\]

観測関数を

\[
s(n) := v_2(3n+1)
\]

とする。

ここで \(v_2(x)\) は 2 進評価（2 の指数）である。

---

## 3. ドリフト（跳ね上がりの代理）

ステップ \(m\) までの \(s\) の和：

\[
S_m := \sum_{i=0}^{m-1} s(T^i(n))
\]

ドリフト（対数的な増減の差）：

\[
D_m := m\log_2 3 - S_m
\]

とおく。

重要なのは最終値 \(D_m\) ではなく、途中の最大値：

\[
\max_{t\le m} D_t
\]

これを **「花弁内での最大上昇（跳ね上がり）」** とみなして統計化する。

---

## 4. 花弁比較（ブロックオフセット比較）

花弁モデルの核心は「比較」にある。

ブロック指数 \(k\) を固定し、基準奇数 \(n_0\) と

\[
n_0' := n_0 + 2^k \cdot m
\]

を比較する（\(m\) はオフセット係数）。

### 4.1 差分指標（s の差）

\[
\Delta s_t := s(n_t') - s(n_t)
\]

差分が初めて出たステップ：

\[
\mathrm{first\_delta} := \min\{t \mid \Delta s_t \ne 0\}
\]

### 4.2 地形指標（オフセットの 2 冪構造）

\[
\Delta n_t := n_t' - n_t,\qquad v_2(|\Delta n_t|)
\]

これは「花弁保存則の地形」を表す。

初期には

\[
\Delta n_0 = 2^k m \Rightarrow v_2(\Delta n_0)=k+v_2(m)
\]

だが、ステップを進めると写像の非線形性により “一致度” が崩れていく。  
その崩れ方が、境界条件の候補になる。

---

## 5. 中核仮説（Working theory）

> ここからは「作業仮説」。真理ではなく、観測で確かめるための道具である。

### H1. 保存則（非特異域の安定）

多くの点では \(\Delta s_t = 0\) が長く続く。  
差が出るのは、基準軌道で \(s(n_t)\) が大きくなる（特異）周辺に偏る。

### H2. 特異筋が差分の発火点

しきい値 \(k\) に対し

\[
s(n)=v_2(3n+1)\ge k
\]

となる点が “特異筋” であり、花弁の境界現象（差分発火）を支配する。

### H3. 跳ね上がりは max-prefix が本体

収束や最終値ではなく

\[
\max_{t\le m} D_t
\]

の分布が “Bad ケース” の抽出に効く。

### H4. 境界は「線」ではなく「尾根」

Bad ケースは孤立点ではなく、統計的に濃淡を持つ帯（尾根）として現れる可能性が高い。  
この尾根が、将来の不等式（境界条件）に変換される。

---

## 6. 実装（Python 実験）

本プロジェクトの実験器は `collatz_experiment.py`。

### 6.1 出力

- `trajectories_k{k}.json`  
  各 \(n_0\) の軌道ログ（\(n,a=3n+1,s,n_{\text{next}}\)、\(S_m\)、\(D_m\)、`max_prefix_D`）
- `differences_k{k}.json`  
  基準 vs オフセットの差分ログ（\(\Delta s_t\)、`first_delta_index`、\(\Delta n_t\)、\(v_2(\Delta n_t)\) など）
- `statistics_k{k}.json`  
  統計（平均・最大・最小・分散など）

### 6.2 注意（観測窓）

`first_delta_index = null` は  
「差分が永遠に無い」ではなく **観測窓内で差が出なかった**ことを意味する。  
（比較長を固定する・比較対象を増やす、などで改善可能）

---

## 7. Lean 形式化（確定事項の固定）

Python 実験は「観測」だが、観測が意味を持つには骨格が要る。  
その骨格を Lean で固定している。

確定した核（例）：

- \(v_2\) の剥ぎ取り（偶数なら 1 回剥ぐ）
- \(v_2(2x)=1+v_2(x)\)
- ブロックシフト \(n \mapsto n+2^k m\) に対する  
  **非特異域での不変性（花弁保存）**  
  ＝「差が出るのは特異筋側だけ」という主張を、形式的に固定

---

## 8. 実験計画（次に回すべき観測）

### 8.1 スケール依存（花弁の自己相似チェック）

\[
k\in\{6,8,10,12\}
\]
で同じ統計を取り、分布が自己相似に安定するかを見る。

### 8.2 サンプル増量

- \(n_0\)：ブロック内の奇数を数千〜数万
- \(m\)：オフセット係数も広げる（1..M）

### 8.3 境界（尾根）を線にするための統計

次を追加すると “境界不等式” に近づく：

- \( \tau_r := \min\{t : v_2(\Delta n_t) < r\} \)（地形崩壊の最初）
- `max_prefix_D` と \(\tau_r\) の相関
- `min_delta_s`（負方向）と跳ね上がりの相関
- 特異筋密度：\(\#\{t\le m : s(n_t)\ge k\}\)

---

## 9. 期待される「境界条件」の形（将来の不等式候補）

最終目標は、例えば次のような形式へ近づくこと：

- “収まりやすさ” の十分条件（経験則 → 準定理）
  \[
  \max_{t\le m} D_t \le C
  \Rightarrow \text{（長期的に大きくは跳ねない）}
  \]
- “Bad” の必要条件（特異筋条件）
  \[
  \exists t \le m,\ s(n_t)\ge k \Rightarrow \text{（差分発火しやすい）}
  \]

この段階では証明よりも、まず **統計的に濃い条件**を見つけることが目的である。

---

## 10. ステータス（現時点）

- ✅ 形式骨格（Lean）：花弁保存の核となる補題が揃い、実験と接続できる
- ✅ 実験器（Python）：軌道ログ・差分ログ・統計が出る
- ✅ 拡張統計：
  - `max_prefix_D`（跳ね上がり）
  - `v2_delta_n`（花弁地形）
  - 負方向の差分統計（`min_delta_s`, `max_abs_delta_s`, `sum_delta_s`）
- ⏳ 次：スケール \(k\) とサンプル数を増やし、尾根の有無（境界の実在）を判定する

---

## Appendix A. 用語

- **花弁（ブロック）**：サイズ \(2^k\) の等比区間
- **特異筋**：\(s(n)=v_2(3n+1)\ge k\) を満たす点（ブロック境界現象を起こしやすい）
- **地形（terrain）**：\(v_2(|\Delta n_t|)\) の時間変化（保存則の崩れ方）
- **跳ね上がり（max-prefix）**：\(\max_{t\le m} D_t\)

---
